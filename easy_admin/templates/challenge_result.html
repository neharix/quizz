{% extends "layout.html" %}
{% load static %}
{% block title %}
    "{{ challenge.name }}" netijeleri
{% endblock title %}
{% block head %}
    <link rel="stylesheet" href="{% static 'css/challenge_result.css' %}">
{% endblock head %}
{% block body %}
    <div class="container my-2">
        <div class="dropdown">
            <button class="btn btn-primary dropbtn">Wagt boýunça almak</button>
            <div id="dr-content" class="dropdown-content">
                <a href="/admin/challenges/{{ challenge_id }}/">Hemmesi</a>
            </div>
        </div>
        <div class="my-2">
            <a href="/admin/get_all/{{ challenge_id }}/{% if day and month and year %}by_date/{{ year }}/{{ month }}/{{ day }}/{% endif %}"
               class="btn btn-primary">Ýükle <i class="bi bi-filetype-docx"></i></a>
        </div>
        <table class="table border-1">
            <thead>
                <tr class="border-bottom-line bg-light">
                    <th scope="col">
                        <a href="?order-by={% if ordered_by == 'index' %}-index{% elif ordered_by == '-index' %}{% else %}index{% endif %}"
                           class="text-dark text-decoration-none">№
                            {% if ordered_by == "index" %}
                                <img src="{% static "svg/sort-up.svg" %}" width="14px" height="14px" alt="up">
                            {% elif ordered_by == "-index" %}
                                <img src="{% static "svg/sort-down.svg" %}" width="14px" height="14px" alt="down">
                            {% else %}
                                <img src="{% static "svg/sort.svg" %}" width="14px" height="14px" alt="sort">
                            {% endif %}
                        </a>
                    </th>
                    <th scope="col">
                        <a href="?order-by={% if ordered_by == 'full_name' %}-full_name{% elif ordered_by == '-full_name' %}{% else %}full_name{% endif %}"
                           class="text-dark text-decoration-none">Familiýasy we Ady
                            {% if ordered_by == "full_name" %}
                                <img src="{% static "svg/sort-up.svg" %}" width="14px" height="14px" alt="up">
                            {% elif ordered_by == "-full_name" %}
                                <img src="{% static "svg/sort-down.svg" %}" width="14px" height="14px" alt="down">
                            {% else %}
                                <img src="{% static "svg/sort.svg" %}" width="14px" height="14px" alt="sort">
                            {% endif %}
                        </a>
                    </th>
                    <th scope="col">
                        <a href="?order-by={% if ordered_by == 'start' %}-start{% elif ordered_by == '-start' %}{% else %}start{% endif %}"
                           class="text-dark text-decoration-none">Başlan wagty
                            {% if ordered_by == "start" %}
                                <img src="{% static "svg/sort-up.svg" %}" width="14px" height="14px" alt="up">
                            {% elif ordered_by == "-start" %}
                                <img src="{% static "svg/sort-down.svg" %}" width="14px" height="14px" alt="down">
                            {% else %}
                                <img src="{% static "svg/sort.svg" %}" width="14px" height="14px" alt="sort">
                            {% endif %}
                        </a>
                    </th>
                    <th scope="col">
                        <a href="?order-by={% if ordered_by == 'end' %}-end{% elif ordered_by == '-end' %}{% else %}end{% endif %}"
                           class="text-dark text-decoration-none">Tamamlan wagty
                            {% if ordered_by == "end" %}
                                <img src="{% static "svg/sort-up.svg" %}" width="14px" height="14px" alt="up">
                            {% elif ordered_by == "-end" %}
                                <img src="{% static "svg/sort-down.svg" %}" width="14px" height="14px" alt="down">
                            {% else %}
                                <img src="{% static "svg/sort.svg" %}" width="14px" height="14px" alt="sort">
                            {% endif %}
                        </a>
                    </th>
                    <th scope="col">
                        <a href="?order-by={% if ordered_by == 'true' %}-true{% elif ordered_by == '-true' %}{% else %}true{% endif %}"
                           class="text-dark text-decoration-none">Dogry jogaplar
                            {% if ordered_by == "true" %}
                                <img src="{% static "svg/sort-up.svg" %}" width="14px" height="14px" alt="up">
                            {% elif ordered_by == "-true" %}
                                <img src="{% static "svg/sort-down.svg" %}" width="14px" height="14px" alt="down">
                            {% else %}
                                <img src="{% static "svg/sort.svg" %}" width="14px" height="14px" alt="sort">
                            {% endif %}
                        </a>
                    </th>
                    <th scope="col">
                        <a href="?order-by={% if ordered_by == 'false' %}-false{% elif ordered_by == '-false' %}{% else %}false{% endif %}"
                           class="text-dark text-decoration-none">Ýalňyş jogaplar
                            {% if ordered_by == "false" %}
                                <img src="{% static "svg/sort-up.svg" %}" width="14px" height="14px" alt="up">
                            {% elif ordered_by == "-false" %}
                                <img src="{% static "svg/sort-down.svg" %}" width="14px" height="14px" alt="down">
                            {% else %}
                                <img src="{% static "svg/sort.svg" %}" width="14px" height="14px" alt="sort">
                            {% endif %}
                        </a>
                    </th>
                    <th scope="col">
                        <a href="?order-by={% if ordered_by == 'result' %}-result{% elif ordered_by == '-result' %}{% else %}result{% endif %}"
                           class="text-dark text-decoration-none">Netije
                            {% if ordered_by == "result" %}
                                <img src="{% static "svg/sort-up.svg" %}" width="14px" height="14px" alt="up">
                            {% elif ordered_by == "-result" %}
                                <img src="{% static "svg/sort-down.svg" %}" width="14px" height="14px" alt="down">
                            {% else %}
                                <img src="{% static "svg/sort.svg" %}" width="14px" height="14px" alt="sort">
                            {% endif %}
                        </a>
                    </th>
                    <th scope="col">
                        <a href="?order-by={% if ordered_by == 'status' %}-status{% elif ordered_by == '-status' %}{% else %}status{% endif %}"
                           class="text-dark text-decoration-none">Statusy
                            {% if ordered_by == "status" %}
                                <img src="{% static "svg/sort-up.svg" %}" width="14px" height="14px" alt="up">
                            {% elif ordered_by == "-status" %}
                                <img src="{% static "svg/sort-down.svg" %}" width="14px" height="14px" alt="down">
                            {% else %}
                                <img src="{% static "svg/sort.svg" %}" width="14px" height="14px" alt="sort">
                            {% endif %}
                        </a>
                    </th>
                    <th scope="col">Hususy DOCX</th>
                    <th scope="col">Umumy DOCX</th>
                </tr>
            </thead>
            <tbody>
                {% for row in users %}
                    <tr class="border-y-line">
                        <th scope="row">{{ row.id }}</th>
                        <td>{{ row.last_name }} {{ row.first_name }}</td>
                        <td>{{ row.start }}</td>
                        <td>{{ row.end }}</td>
                        <td>{{ row.true_answer }}</td>
                        <td>{{ row.false_answer }}</td>
                        <td>{{ row.percent }}%</td>
                        {% if row.is_finished %}
                            <td class="true">
                                <b>Tamamlady</b>
                            </td>
                        {% else %}
                            <td class="false">
                                <b>Dowam edýär</b>
                            </td>
                        {% endif %}
                        <td>
                            <a href="/admin/get_private/{{ row.challenge_id }}/{{ row.user_id }}/"
                               class="btn btn-primary"><i class="bi bi-filetype-docx"></i></a>
                        </td>
                        <td>
                            <a href="/admin/get_detailed/{{ row.challenge_id }}/{{ row.user_id }}/"
                               class="btn btn-primary"><i class="bi bi-filetype-docx"></i></a>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        {% if users.paginator.num_pages != 1 %}
            {% include "pagination.html" with page=users paginator_range=paginator_range %}
        {% endif %}
    </div>
{% endblock body %}
{% block scripts %}
    {{ challenge.pk|json_script:"challenge-id" }}
    {{ dates|json_script:"dates" }}
    <script>
        let dropdown = document.querySelector("#dr-content");
        let dates = JSON.parse(document.getElementById('dates').textContent);
        const challenge_id = JSON.parse(document.getElementById("challenge-id").textContent);

        for (let i = 0; i < dates.length; i++) {
            let dropdown_item = document.createElement("a");
            dropdown_item.innerHTML = dates[i];
            let date_params = dates[i].split(".");
            dropdown_item.href = "/admin/challenges/" + challenge_id + "/by_date/" + date_params[2] + "/" + date_params[1] + "/" + date_params[0] + "/";
            dropdown.appendChild(dropdown_item);
        } 
    </script>
{% endblock scripts %}
